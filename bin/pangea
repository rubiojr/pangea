#!/usr/bin/ruby
require 'rubygems'
require 'term/ansicolor'

begin
  require "#{File.join(File.dirname(__FILE__), '../lib/pangea.rb')}"
rescue
  require 'pangea'
end

config = nil
File.open 'config.yml' do |f|
  config = YAML.load f
end

hc = Pangea::Cluster.new(config['cluster_nodes'])

class String
  include Term::ANSIColor
end

hc.hosts.each do |h|
  puts h.name_label.bold
  tmb = h.metrics.memory_total
  fmb = h.metrics.memory_free
  total_mem = Pangea::Util.humanize_bytes(tmb)
  free_mem = Pangea::Util.humanize_bytes(fmb)
  puts "  Total memory: #{total_mem} (#{tmb})"
  puts "  Free memory: #{free_mem} (#{fmb})"
  puts "  Resident VMs"
  h.resident_vms.each do |vm|
    puts "    " + vm.name_label
  end
end
